---
- name: Check if Node is installed
  ansible.builtin.stat:
    path: /usr/local/node/bin
  register: node_bin

- name: Download Node.js binary
  ansible.builtin.get_url:
    url: "https://nodejs.org/dist/v{{ node_version }}/node-v{{ node_version }}-linux-x64.tar.xz"
    dest: /tmp/node.tar.xz
  when: not node_bin.stat.exists

- name: Extract Node.js binary
  ansible.builtin.unarchive:
    src: /tmp/node.tar.xz
    dest: /usr/local
    remote_src: yes
  when: not node_bin.stat.exists

- name: Add Node to system-wide PATH
  ansible.builtin.copy:
    dest: /etc/profile.d/node_path.sh
    content: "export PATH=$PATH:/usr/local/node/bin"
    mode: "0644"

- name: Clean up temporary files
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /tmp/node.tar.xz
